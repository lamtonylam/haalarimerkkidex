{% extends 'base.html' %}
{% block title %}Merkit{% endblock %}

{% block content %}
  {% with messages = get_flashed_messages() %}
    {% if messages %}
      {% for message in messages %}
        <div class="alert alert-success text-center" role="alert">
          {{ message }}
        </div>
      {% endfor %}
    {% endif %}
  {% endwith %}
  {% if session.username %}
    <p>Olet kirjautunut nimellä: <b>{{ session.username }}</b></p>

    <h4>Kaikki yhteisön haalarimerkit</h4>

    <div class="br-tag"></div>
    <form action="/kirjautunut" method="GET">
      <div class="form-group">
        <select name="sort" id="sort" class="form-control form-box">
          <option value="asc">Vanhin ensin</option>
          <option value="desc">Uusin ensin</option>
        </select>
      </div>

      <div class="input-group mb-3 form-box">
        <input
          type="text"
          name="query"
          class="form-control"
          placeholder="Hakusana:"
          aria-label="Hakusana:"
          aria-describedby="button-addon2"
          maxlength="100"
        />
        <select name="category" id="category" class="form-control">
          <option value="">Valitse kategoria</option>
          {% for category in categories %}
            <option value="{{ category.id }}">{{ category.name }}</option>
          {% endfor %}
        </select>

        <div class="input-group-append">
          <button class="btn btn-primary btn" type="submit" id="button-addon2">
            Lähetä
          </button>
        </div>
      </div>
    </form>

    <hr />
    {% for result, image in results %}
      <p>Merkin nimi: <b>{{ result.name }}</b></p>
      {% if image %}
        <img
          src="data:image/jpeg;base64,{{ image }}"
          alt="Image for patch {{ result[1] }}"
          class="image-thumbnail-kirjautunut"
        />
        <br />
        <br />
      {% endif %}
      <a class="btn btn-outline-primary btn-sm" href="/merkki/{{ result.id }}"
        >Katso lisätietoja / Lisää merkki omaan kokoelmaasi</a
      >

      <hr />
    {% endfor %}
  {% endif %}

  {% if not session.username %}
    <p>
      Et ole kirjautunut sisään. Kirjaudu sisään, jotta voit lisätä uusia
      haalarimerkkejä.
    </p>
    <button onclick="window.location.href='/login'" class="btn btn-primary">
      Kirjaudu sisään
    </button>
  {% endif %}
{% endblock %}
